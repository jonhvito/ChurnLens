ChurnLens Flask Application - Estrutura Completa
================================================

churnlens/
â”‚
â”œâ”€â”€ ğŸš€ ENTRYPOINT
â”‚   â””â”€â”€ run.py                          # Inicia servidor Flask
â”‚
â”œâ”€â”€ ğŸ“¦ DEPENDÃŠNCIAS
â”‚   â””â”€â”€ requirements.txt                # Flask + Pandas
â”‚
â”œâ”€â”€ ğŸ“š DOCUMENTAÃ‡ÃƒO
â”‚   â”œâ”€â”€ README.md                       # DocumentaÃ§Ã£o completa
â”‚   â”œâ”€â”€ MIGRATION.md                    # Guia de migraÃ§Ã£o (app.py â†’ Flask)
â”‚   â”œâ”€â”€ QUICKSTART.md                   # Quick start guide
â”‚   â”œâ”€â”€ PROJECT_SUMMARY.md              # Resumo do projeto
â”‚   â””â”€â”€ .gitignore                      # Git ignore
â”‚
â”œâ”€â”€ ğŸ¯ APPLICATION (app/)
â”‚   â”‚
â”‚   â”œâ”€â”€ __init__.py                     # Flask factory (create_app)
â”‚   â”œâ”€â”€ config.py                       # ConfiguraÃ§Ãµes centralizadas
â”‚   â”œâ”€â”€ web.py                          # Blueprint: rotas web (HTML)
â”‚   â””â”€â”€ api.py                          # Blueprint: rotas API (JSON + CSV)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ§  CORE (LÃ³gica Pura - Zero I/O)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ pipeline.py                 # â­ 13 funÃ§Ãµes do pipeline RFM
â”‚   â”‚   â”‚                                 - clean_orders()
â”‚   â”‚   â”‚                                 - clean_payments()
â”‚   â”‚   â”‚                                 - aggregate_payments_by_order()
â”‚   â”‚   â”‚                                 - join_datasets()
â”‚   â”‚   â”‚                                 - compute_customer_features()
â”‚   â”‚   â”‚                                 - add_churn_label()
â”‚   â”‚   â”‚                                 - qcut_safe()
â”‚   â”‚   â”‚                                 - compute_rfm_scores()
â”‚   â”‚   â”‚                                 - compute_risk_segments()
â”‚   â”‚   â”‚                                 - run_pipeline()
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ validation.py               # ValidaÃ§Ã£o de schemas CSV
â”‚   â”‚   â”‚                                 - validate_customers_schema()
â”‚   â”‚   â”‚                                 - validate_orders_schema()
â”‚   â”‚   â”‚                                 - validate_payments_schema()
â”‚   â”‚   â”‚                                 - validate_datasets()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ schemas.py                  # Dataclasses e estruturas
â”‚   â”‚                                     - KPIs
â”‚   â”‚                                     - RFMChurnData
â”‚   â”‚                                     - RiskSegmentData
â”‚   â”‚                                     - TopRiskCustomer
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ”§ SERVICES (I/O + Cache)
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ data_service.py             # DataService class
â”‚                                         - load_raw_data()
â”‚                                         - get_features() [com cache]
â”‚                                         - get_kpis()
â”‚                                         - get_churn_by_rfm()
â”‚                                         - get_recency_histogram()
â”‚                                         - get_risk_summary()
â”‚                                         - get_top_risk()
â”‚                                         - get_all_features()
â”‚
â”œâ”€â”€ ğŸ¨ FRONTEND
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ TEMPLATES (Jinja2)
â”‚   â”‚   â”œâ”€â”€ base.html                   # Template base (header, footer)
â”‚   â”‚   â”œâ”€â”€ dashboard.html              # Dashboard principal
â”‚   â”‚   â””â”€â”€ error.html                  # PÃ¡gina de erro
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“¦ STATIC ASSETS
â”‚       â”œâ”€â”€ css/
â”‚       â”‚   â””â”€â”€ app.css                 # CSS customizado
â”‚       â”‚
â”‚       â””â”€â”€ js/
â”‚           â””â”€â”€ dashboard.js            # Chart.js + fetch API
â”‚                                         - loadChurnByRFM()
â”‚                                         - loadRecencyHist()
â”‚                                         - loadTopRiskTable()
â”‚
â””â”€â”€ ğŸ§ª TESTES
    â”œâ”€â”€ __init__.py
    â””â”€â”€ test_pipeline.py                # 6 testes unitÃ¡rios
                                          âœ“ test_churn_label_threshold
                                          âœ“ test_rfm_score_range
                                          âœ“ test_no_negative_monetary
                                          âœ“ test_clean_orders_removes_invalid
                                          âœ“ test_aggregate_payments_sums_correctly
                                          âœ“ test_qcut_safe_handles_duplicates


ğŸ“Š DADOS (../data/)
â”œâ”€â”€ olist_customers_dataset.csv         # ~99k linhas
â”œâ”€â”€ olist_orders_dataset.csv            # ~99k linhas
â””â”€â”€ olist_order_payments_dataset.csv    # ~104k linhas


ğŸŒ ENDPOINTS DISPONÃVEIS
=========================

WEB (HTML)
----------
GET  /                  â†’ Dashboard principal
GET  /health            â†’ Health check

API (JSON)
----------
GET  /api/summary       â†’ KPIs gerais
GET  /api/churn_by_rfm  â†’ Churn rate por RFM score
GET  /api/recency_hist  â†’ Histograma de recency (bins)
GET  /api/risk_summary  â†’ Resumo por segmento de risco
GET  /api/top_risk      â†’ Top 50 clientes em risco

EXPORT (CSV)
------------
GET  /export/customers.csv  â†’ Todas features de clientes
GET  /export/top_risk.csv   â†’ Top 50 clientes em risco


ğŸ”§ CONFIGURAÃ‡ÃƒO (VariÃ¡veis de Ambiente)
========================================
CHURN_THRESHOLD_DAYS    â†’ Dias para considerar churn (default: 270)
FLASK_DEBUG             â†’ Debug mode (default: True)
FLASK_HOST              â†’ Host (default: 0.0.0.0)
FLASK_PORT              â†’ Porta (default: 5000)
CACHE_ENABLED           â†’ Ativar cache (default: True)


ğŸ“ˆ PIPELINE DE ANÃLISE
======================
1. Carregar CSVs (customers, orders, payments)
2. Validar schemas
3. Limpar dados (nulls, duplicatas, valores invÃ¡lidos)
4. Agregar pagamentos por pedido
5. Join datasets (customer_id, order_id)
6. Calcular features RFM por cliente:
   - Recency (dias desde Ãºltima compra)
   - Frequency (nÃºmero de pedidos)
   - Monetary (receita total)
   - Tenure (dias desde primeira compra)
   - Avg Ticket (ticket mÃ©dio)
7. Aplicar label de churn (recency >= threshold)
8. Calcular RFM scores (quintis 1-5)
9. Segmentar por risco (regras de negÃ³cio)
10. Cachear resultado


ğŸ¯ PRINCÃPIOS APLICADOS
========================
âœ“ Clean Code
  - FunÃ§Ãµes pequenas e focadas
  - Nomes descritivos
  - DRY (Don't Repeat Yourself)
  - KISS (Keep It Simple)

âœ“ Separation of Concerns
  - Core: lÃ³gica pura
  - Services: I/O e cache
  - Web/API: apresentaÃ§Ã£o
  - Templates: UI

âœ“ Testability
  - FunÃ§Ãµes puras (sem side effects)
  - InjeÃ§Ã£o de dependÃªncias
  - Mocks fÃ¡ceis

âœ“ SOLID
  - Single Responsibility
  - Open/Closed
  - Dependency Inversion

âœ“ Imutabilidade
  - FunÃ§Ãµes retornam novos DataFrames
  - NÃ£o modificam inputs


ğŸ“Š ESTATÃSTICAS
================
Total de arquivos: 24
Linhas de cÃ³digo: ~1.500
Testes: 6 (100% passando)
Cobertura: Core pipeline

Antes: 1 arquivo, 163 linhas, 0 testes
Depois: 24 arquivos, bem organizados, 6 testes


ğŸš€ COMANDOS RÃPIDOS
===================
# Instalar
pip install -r requirements.txt

# Rodar
python run.py

# Testar
pytest tests/ -v

# Acessar
http://localhost:5000


âœ¨ FEATURES IMPLEMENTADAS
==========================
âœ“ Dashboard web interativo
âœ“ GrÃ¡ficos Chart.js (churn por RFM, recency hist)
âœ“ Tabela top 50 clientes em risco
âœ“ API REST (JSON)
âœ“ Export CSV
âœ“ Cache de resultados
âœ“ ValidaÃ§Ã£o de dados
âœ“ Tratamento de erros
âœ“ Design responsivo (Tailwind)
âœ“ Testes unitÃ¡rios
âœ“ DocumentaÃ§Ã£o completa


